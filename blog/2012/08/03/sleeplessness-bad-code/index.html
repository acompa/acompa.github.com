
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Sleeplessness &rarr; bad code - Witty Math Title Here</title>
	<meta name="author" content="Alejandro Companioni">

	
	<meta name="description" content="David Smith recently pushed out an excellent episode of his &#8220;Developing Perspectives&#8221; podcast. In it, he discusses the importance of rest &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Witty Math Title Here" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic' rel='stylesheet' type='text/css'>
</head>

<body>
	<div class="container">	

			<div class="mid-col-container">
				<div id="content" class="inner">
					<article class="post">
	<h1 class="title">Sleeplessness &rarr; bad code</h1>
	<div class="entry-content"><p>David Smith recently pushed out <a href="http://developingperspective.com/2012/08/02/70/">an excellent episode</a> of his &#8220;Developing Perspectives&#8221; podcast. In it, he discusses the importance of rest, especially as it relates to the quality of a developer&#8217;s work.</p>

<p>A big product launch at Knewton and a semester-long OS class compressed into 10 weeks leaves little time for rest, so I wasn&#8217;t surprised to notice a sizable drop-off in my cognitive ability while working on my last OS lab a few weeks ago. My lab (a toy virtual memory management unit responsible for virtual paging) is written in Java &#8211; a language I&#8217;m learning this summer &#8211; and while I have a rational understanding of how it works (having studied it in a programming languages class last semester), I&#8217;m not 100% comfortable with it just yet.</p>

<p>That discomfort manifested as a few, time-consuming mistakes during a couple of tough, sleepless weeks. As an example, I&#8217;ll talk about how I made a silly type casting mistake.</p>

<p>My toy virtual memory manager (VMM) needed to swap pages in and out of physical memory whenever new instructions would arrive. There are a number of algorithms for page replacement, so I gave the user the option of selecting from a subset of these:</p>

<pre><code>private ReplacementAlgorithm algo;
...
// Attach the right algorithm.
this.algo = selectReplacementAlgorithm(algo);
...
private ReplacementAlgorithm selectReplacementAlgorithm(String choice) {
    if (choice.matches("N")) {
        return new NRUAlgorithm();
    } else if (choice.matches("l")) {
        return new LRUAlgorithm();
    ...
}
</code></pre>

<p>Each of those algorithm objects implement basic methods from a ReplacementAlgorithm interface, but they also have their own logic (eg. debugging output or actions performed on internal queues). Thus, the VMM calls various methods depending on the page replacement algorithm selected by the user:</p>

<pre><code>if (this.printAdditionalDetails) {
    if (this.algo instanceof FIFOAlgorithm) {
        ((FIFOAlgorithm) this.algo).printQueueContents();
        System.out.printf("\n");
    } else if (this.algo instanceof PhysicalClockAlgorithm) {
        ((PhysicalClockAlgorithm) this.algo).printClock();
        System.out.printf("\n");
...
</code></pre>

<p>At one point, one of the replacement algorithms was not updating its internal state correctly, thus causing it to replace pages incorrectly. Here&#8217;s where the sleep deprivation came in: I actually spent a non-trivial amount of time (about 1-2 hours) refactoring my code because I thought the type checking statements above identified every algorithm as a ReplacementAlgorithm, and not as a LRUAlgorithm, NRUAlgorithm, etc.</p>

<p>In retrospect, it was a dumb assumption. Java interfaces are a basic example of OO inheritance, and an object of a class that implements an interface clearly has both the class&#8217;s type and the interface&#8217;s type. The behavior is the same in Python&#8211;here&#8217;s an example:</p>

<pre><code>&gt;&gt;&gt; class Foo(object): pass
&gt;&gt;&gt; class Bar(Foo): pass
&gt;&gt;&gt; isinstance(Bar(), Foo)
True
</code></pre>

<p>Anyway, just an example of a silly mistake fueled by sleep deprivation that cost a few hours of lost dev time. Make sure to get your sleep!</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<!-- <a class="addthis_counter addthis_pill_style"></a> -->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



				</div>
			</div>
			<footer id="footer" class="inner">
				Copyright &copy; 2015 

    <a href="/about">Alejandro Companioni</a>
 |
<span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, customized with <a href="https://github.com/mjhea0/nologo">noLogo</a></span></footer>
			<script src="/javascripts/slash.js"></script>








	</div>
</body>
</html>
