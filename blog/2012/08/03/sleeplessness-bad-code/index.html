
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Sleeplessness &rarr; bad code - Witty Math Title Here</title>
  <meta name="author" content="Alejandro Companioni">

  
  <meta name="description" content="David Smith recently pushed out an excellent episode of his &#8220;Developing Perspectives&#8221; podcast. In it, he discusses the importance of rest &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://acompa.github.com/blog/2012/08/03/sleeplessness-bad-code/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Witty Math Title Here" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!--MathJax -->
<script type="text/javascript"
	  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Witty Math Title Here</a></h1>
  
    <h2>Learning about machine learning and statistics, one mistake at a time.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:acompa.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="http://www.quora.com/Alex-Companioni/Excellent-ML-Statistics-Answers">Quora Board</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Sleeplessness &rarr; bad code</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-03T18:42:00-04:00" pubdate data-updated="true">Aug 3<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>David Smith recently pushed out <a href="http://developingperspective.com/2012/08/02/70/">an excellent episode</a> of his &#8220;Developing Perspectives&#8221; podcast. In it, he discusses the importance of rest, especially as it relates to the quality of a developer&#8217;s work.</p>

<p>A big product launch at Knewton and a semester-long OS class compressed into 10 weeks leaves little time for rest, so I wasn&#8217;t surprised to notice a sizable drop-off in my cognitive ability while working on my last OS lab a few weeks ago. My lab (a toy virtual memory management unit responsible for virtual paging) is written in Java &#8211; a language I&#8217;m learning this summer &#8211; and while I have a rational understanding of how it works (having studied it in a programming languages class last semester), I&#8217;m not 100% comfortable with it just yet.</p>

<p>That discomfort manifested as a few, time-consuming mistakes during a couple of tough, sleepless weeks. As an example, I&#8217;ll talk about how I made a silly type casting mistake.</p>

<p>My toy virtual memory manager (VMM) needed to swap pages in and out of physical memory whenever new instructions would arrive. There are a number of algorithms for page replacement, so I gave the user the option of selecting from a subset of these:</p>

<pre><code>private ReplacementAlgorithm algo;
...
// Attach the right algorithm.
this.algo = selectReplacementAlgorithm(algo);
...
private ReplacementAlgorithm selectReplacementAlgorithm(String choice) {
    if (choice.matches("N")) {
        return new NRUAlgorithm();
    } else if (choice.matches("l")) {
        return new LRUAlgorithm();
    ...
}
</code></pre>

<p>Each of those algorithm objects implement basic methods from a ReplacementAlgorithm interface, but they also have their own logic (eg. debugging output or actions performed on internal queues). Thus, the VMM calls various methods depending on the page replacement algorithm selected by the user:</p>

<pre><code>if (this.printAdditionalDetails) {
    if (this.algo instanceof FIFOAlgorithm) {
        ((FIFOAlgorithm) this.algo).printQueueContents();
        System.out.printf("\n");
    } else if (this.algo instanceof PhysicalClockAlgorithm) {
        ((PhysicalClockAlgorithm) this.algo).printClock();
        System.out.printf("\n");
...
</code></pre>

<p>At one point, one of the replacement algorithms was not updating its internal state correctly, thus causing it to replace pages incorrectly. Here&#8217;s where the sleep deprivation came in: I actually spent a non-trivial amount of time (about 1-2 hours) refactoring my code because I thought the type checking statements above identified every algorithm as a ReplacementAlgorithm, and not as a LRUAlgorithm, NRUAlgorithm, etc.</p>

<p>In retrospect, it was a dumb assumption. Java interfaces are a basic example of OO inheritance, and an object of a class that implements an interface clearly has both the class&#8217;s type and the interface&#8217;s type. The behavior is the same in Python&#8211;here&#8217;s an example:</p>

<pre><code>&gt;&gt;&gt; class Foo(object): pass
&gt;&gt;&gt; class Bar(Foo): pass
&gt;&gt;&gt; isinstance(Bar(), Foo)
True
</code></pre>

<p>Anyway, just an example of a silly mistake fueled by sleep deprivation that cost a few hours of lost dev time. Make sure to get your sleep!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Alejandro Companioni</span></span>

      








  


<time datetime="2012-08-03T18:42:00-04:00" pubdate data-updated="true">Aug 3<span>rd</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://acompa.github.com/blog/2012/08/03/sleeplessness-bad-code/" data-via="achompas" data-counturl="http://acompa.github.com/blog/2012/08/03/sleeplessness-bad-code/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/07/20/using-item-response-theory-instead-of-traditional-grading-to-assess-student-proficiency/" title="Previous Post: Using Item Response Theory Instead of Traditional Grading to Assess Student Proficiency">&laquo; Using Item Response Theory Instead of Traditional Grading to Assess Student Proficiency</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/09/07/installing-r-and-rpy2-from-scratch/" title="Next Post: Installing R and rpy2 from scratch">Installing R and rpy2 from scratch &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/10/05/presenting-leptoid-at-surge-2012/">Presenting leptoid at Surge 2012</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/07/installing-r-and-rpy2-from-scratch/">Installing R and rpy2 from scratch</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/03/sleeplessness-bad-code/">Sleeplessness &rarr; bad code</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/20/using-item-response-theory-instead-of-traditional-grading-to-assess-student-proficiency/">Using Item Response Theory Instead of Traditional Grading to Assess Student Proficiency</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/acompa">@acompa</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'acompa',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("achompas", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/achompas" class="twitter-follow-button" data-show-count="false">Follow @achompas</a>
  
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:acompa">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "acompa"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Alejandro Companioni -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
